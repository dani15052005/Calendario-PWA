/* =========================
   Tema (Dark por defecto)
   ========================= */
:root{
  /* Dark neutro (grafito) */
  --bg:#0e0f12;
  --panel:#15171c;
  --card:#1b1e24;
  --muted:#9aa3b2;
  --text:#eaeef5;
  --primary:#0ea5e9;
  --danger:#ef4444;
  --ring: rgba(14,165,233,.45);

  /* categorías (pills: vista de tiempo) */
  --cat-trabajo:#38bdf8;
  --cat-citas:#f59e0b;
  --cat-cumple:#22c55e;
  --cat-otros:#a78bfa;
  --cat-tarea:#10b981; /* Tarea: teal consistente */
}

/* Light mode overrides */
html[data-theme="light"]{
  --bg:#f6f7fb;
  --panel:#ffffff;
  --card:#ffffff;
  --muted:#5b6377;
  --text:#0b1220;
  --primary:#0ea5e9;
  --danger:#e11d48;
  --ring: rgba(14,165,233,.35);

  --cat-trabajo:#0284c7;
  --cat-citas:#b45309;
  --cat-cumple:#15803d;
  --cat-otros:#6d28d9;
  --cat-tarea:#0f766e; /* teal más oscuro para contraste en light */
}

*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0;
  font-family: "Source Sans 3", system-ui, -apple-system, "Segoe UI", Roboto, Inter, Ubuntu, "Helvetica Neue", Arial, sans-serif;
  color:var(--text);
  background:var(--bg);
}
.hidden{ display:none !important; }
.muted{ color:var(--muted) }
.spacer{ flex:1 }
.small{ font-size:.85rem; padding:.35rem .55rem }

/* =========================
   Topbar + búsqueda
   ========================= */
.topbar{
  display:flex; align-items:center; gap:.75rem;
  padding:.8rem 1rem;
  position:sticky; top:0; z-index:50;
  background:rgba(21,23,29,.75);
  backdrop-filter: blur(8px);
  border-bottom:1px solid rgba(255,255,255,.07);
}
html[data-theme="light"] .topbar{
  background:rgba(255,255,255,.75);
  border-bottom:1px solid rgba(17,24,39,.06);
}
.app-title{ margin:0 .25rem 0 0; font-size:1.1rem; font-weight:600 }

.search-wrap{
  position:relative; display:flex; align-items:center; gap:.4rem; width:min(560px,100%); margin-left:auto
}
.search-wrap input[type="search"]{
  width:100%; padding:.6rem .8rem; border-radius:.7rem;
  border:1px solid rgba(255,255,255,.1);
  background:var(--card); color:var(--text); outline:none;
}
html[data-theme="light"] .search-wrap input[type="search"]{
  border-color: rgba(17,24,39,.12);
}
.search-wrap input[type="search"]:focus{ border-color:var(--primary); box-shadow:0 0 0 3px var(--ring) }
.search-wrap .ghost{ background:transparent; border:0; color:var(--muted); font-size:1.1rem; cursor:pointer }

.search-results{
  position:absolute; top:42px; left:0; right:0; max-height:320px; overflow:auto; z-index:60;
  background:var(--panel);
  border:1px solid rgba(255,255,255,.08);
  border-radius:.75rem; display:none;
}
html[data-theme="light"] .search-results{ border-color: rgba(17,24,39,.08) }
.search-results.open{ display:block }
.search-results .result{ padding:.7rem .9rem; border-bottom:1px solid rgba(255,255,255,.06); cursor:pointer }
html[data-theme="light"] .search-results .result{ border-bottom-color: rgba(17,24,39,.06) }
.search-results .result:hover{ background:rgba(255,255,255,.05) }
html[data-theme="light"] .search-results .result:hover{ background:rgba(17,24,39,.04) }

/* =========================
   Botones base
   ========================= */
button{
  background:#23262d;
  color:var(--text);
  border:1px solid rgba(255,255,255,.12);
  border-radius:.55rem; padding:.5rem .75rem; cursor:pointer;
}
html[data-theme="light"] button{
  background:#eef2ff; color:var(--text);
  border-color: rgba(17,24,39,.12);
}
button.primary{ background:var(--primary); border-color:transparent; color:white }
button.danger{ background:var(--danger); border-color:transparent; color:white }
button.ghost{ background:transparent; border-color:transparent; color:var(--text) }
button:focus{ outline:none; box-shadow:0 0 0 3px var(--ring) }
button:disabled{ opacity:.6; cursor:not-allowed }

/* Botón “Ir a la fecha” redondeado (único) */
.jump-row button,
#jumpBtn{
  border-radius: 999px !important;
  padding: .45rem .85rem;
}

/* =========================
   Hamburger + Drawer
   ========================= */
.hamburger{
  width:38px; height:38px; display:grid; place-items:center; border-radius:.6rem;
  background:transparent; border:1px solid rgba(255,255,255,.12);
}
html[data-theme="light"] .hamburger{ border-color: rgba(17,24,39,.12) }
.hamburger span{
  display:block; width:20px; height:2px; background:var(--text); border-radius:2px; transition:transform .25s, opacity .2s;
}
.hamburger span:nth-child(2){ margin:5px 0 }
.hamburger.active span:nth-child(1){ transform: translateY(7px) rotate(45deg) }
.hamburger.active span:nth-child(2){ opacity:0 }
.hamburger.active span:nth-child(3){ transform: translateY(-7px) rotate(-45deg) }

.drawer{
  position:fixed; inset:0 auto 0 0; width:300px; background:var(--panel);
  border-right:1px solid rgba(255,255,255,.08);
  transform: translateX(-100%); transition: transform .25s ease-out; z-index:70;
  display:flex; flex-direction:column; padding:.75rem .9rem; overflow:auto;
}
html[data-theme="light"] .drawer{ border-right-color: rgba(17,24,39,.08) }
.drawer.open{ transform:translateX(0) }
.drawer-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.35); backdrop-filter:blur(2px); z-index:65; display:none;
}
.drawer-backdrop.open{ display:block }

.drawer-head{ display:flex; align-items:center; gap:.5rem; padding-bottom:.4rem; border-bottom:1px solid rgba(255,255,255,.06) }
html[data-theme="light"] .drawer-head{ border-bottom-color: rgba(17,24,39,.06) }
.drawer-section{ padding:.8rem 0; border-bottom:1px solid rgba(255,255,255,.06) }
.drawer-section:last-child{ border-bottom:0 }
html[data-theme="light"] .drawer-section{ border-bottom-color: rgba(17,24,39,.06) }
.drawer-section h3{ margin:.1rem 0 .6rem 0; font-size:.95rem }

.segmented{
  display:grid; grid-template-columns:repeat(4,1fr); gap:.4rem;
}
.segmented label{
  user-select:none; display:flex; align-items:center; justify-content:center;
  gap:.35rem; padding:.5rem .6rem; border-radius:.6rem; cursor:pointer;
  border:1px solid rgba(255,255,255,.12); background:var(--card);
  font-size:.92rem; position:relative;
}
.segmented input{
  appearance:none;
  width:1px; height:1px;
  position:absolute; opacity:0;
  pointer-events:auto;
}
.segmented label:has(input:checked){
  background:var(--primary); color:white; border-color:transparent;
}

.checks{ display:grid; grid-template-columns:1fr 1fr; gap:.4rem }
.checks label{
  display:flex; align-items:center; gap:.5rem; padding:.45rem .6rem; border-radius:.6rem;
  background:var(--card); border:1px solid rgba(255,255,255,.1);
}
html[data-theme="light"] .checks label{ border-color: rgba(17,24,39,.12) }

.theme-toggle{ width:100% }

/* =========================
   VISTA MES
   ========================= */
.layout{ display:grid; grid-template-columns:1fr; gap:1rem; padding:1rem; }
.calendar-panel{
  background:var(--panel); border:1px solid rgba(255,255,255,.06);
  border-radius:1rem; padding:1rem;
}
html[data-theme="light"] .calendar-panel{ border-color: rgba(17,24,39,.08) }

.calendar-nav{ display:flex; justify-content:space-between; align-items:center; gap:.5rem; margin-bottom:.5rem }
.calendar-nav button{ border-radius:999px }
.nav-center{ display:flex; align-items:center; gap:1rem }
.month-title{ font-weight:600 }
.jump-row{ display:flex; align-items:center; gap:.5rem; margin:.25rem 0 1rem 0 }

.weekday-row{ display:grid; grid-template-columns:repeat(7,1fr); text-align:center; color:var(--muted); gap:.25rem; margin-bottom:.25rem }
.weekday-row > div{ padding:.25rem 0; font-size:.85rem }

.calendar-grid{ display:grid; grid-template-columns:repeat(7,1fr); gap:.25rem }
.day{
  min-height:110px; background:var(--card);
  border:1px solid rgba(255,255,255,.06);
  border-radius:.6rem; padding:.5rem; display:flex; flex-direction:column; cursor:pointer;
}
html[data-theme="light"] .day{ border-color: rgba(17,24,39,.08) }
.day .day-head{ display:flex; justify-content:space-between; align-items:center; margin-bottom:.35rem }
.day .num{ font-weight:600; font-size:.95rem }
.day .badge{ display:none } /* sin contador circular */
.day.today{ outline:2px solid var(--primary) }
.day.out{ opacity:.45; pointer-events:none }

/* Etiquetas de eventos (vista mes) */
.day .events-tags{
  display:flex; flex-wrap:wrap; gap:.3rem; margin-top:.35rem
}
.event-tag{
  display:inline-block; padding:.2rem .5rem; border-radius:999px;
  font-size:.75rem; font-weight:700; line-height:1; color:#fff;
  max-width:100%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  box-shadow:0 1px 2px rgba(0,0,0,.15);
}
/* Colores por categoría (vista mes) */
.event-tag.cat-Trabajo{ background:#ef4444 }                 /* rojo */
.event-tag.cat-Tarea{ background:var(--cat-tarea); color:#051a13 } /* teal, legible */
.event-tag.cat-Cumpleaños{ background:#22c55e }              /* verde */
.event-tag.cat-Citas{ background:#3b82f6 }                   /* azul */
.event-tag.cat-Otros{ background:#c4b5fd; color:#140a2b }    /* morado claro */
/* Festivos en vista mes */
.event-tag.cat-Festivo{
  background: #e11d48;
  color: #fff;
  font-weight: 800;
}

/* =========================
   VISTA SEMANA / 3 DÍAS / DÍA
   ========================= */
.time-panel{
  background:var(--panel); border:1px solid rgba(255,255,255,.06);
  border-radius:1rem; overflow:hidden;
}
html[data-theme="light"] .time-panel{ border-color: rgba(17,24,39,.08) }

:root { --topbar-h: 72px; }
@media (max-width: 900px){ :root { --topbar-h: 64px; } }

.time-header{
  position:sticky; top:var(--topbar-h); z-index:10;
  display:flex; align-items:center; gap:.75rem; padding:.7rem 1rem;
  background:rgba(21,23,29,.85);
  backdrop-filter:blur(8px);
  border-bottom:1px solid rgba(255,255,255,.06);
}
html[data-theme="light"] .time-header{ background:rgba(255,255,255,.8); border-bottom-color: rgba(17,24,39,.06) }
.time-title{ font-weight:600 }

.time-days-header{
  position: sticky;
  top: calc(var(--topbar-h) + 48px);
  z-index: 11;
  background: var(--panel);
  border-bottom: 1px solid rgba(255,255,255,.06);
  display:grid; grid-auto-flow:column; grid-auto-columns:1fr; gap:0;
}
html[data-theme="light"] .time-days-header{
  border-bottom-color: rgba(17,24,39,.06);
}
.time-days-header .day-head-cell{
  background: transparent;
  padding: .5rem .5rem;
  text-align:center; font-weight:700; font-size:.9rem;
}

/* Grid de horas */
.time-grid{
  display:grid; grid-auto-flow:column; grid-auto-columns:1fr; min-height:60vh;
  position:relative; overflow:hidden; /* se activa con has-events */
  background:
    linear-gradient(var(--panel), var(--panel)) padding-box,
    repeating-linear-gradient(to bottom, rgba(255,255,255,.06) 0, rgba(255,255,255,.06) 1px, transparent 1px, transparent 60px);
}
html[data-theme="light"] .time-grid{
  background:
    linear-gradient(var(--panel), var(--panel)) padding-box,
    repeating-linear-gradient(to bottom, rgba(17,24,39,.07) 0, rgba(17,24,39,.07) 1px, transparent 1px, transparent 60px);
}
.time-grid.has-events{ overflow-y:auto }

/* Columna de día (contiene los eventos posicionados por JS) */
.day-col{ position:relative; min-height:960px; border-right:1px solid rgba(255,255,255,.06) }
.day-col:last-child{ border-right:0 }
html[data-theme="light"] .day-col{ border-right-color: rgba(17,24,39,.06) }

/* Píldoras de evento (vista de tiempo) */
.event-pill{
  position:absolute; left:6px; right:6px; min-height:36px;
  padding:.35rem .45rem; border-radius:.55rem; color:#0b1220; font-weight:600;
  background:#93c5fd; /* fallback */
  box-shadow:0 6px 18px rgba(0,0,0,.22);
  display:flex; gap:.35rem; align-items:center; pointer-events:auto;
}
.event-pill .pill-time{ font-variant-numeric:tabular-nums; opacity:.9 }
.event-pill .pill-title{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
/* Píldoras estrechas cuando hay cluster */
.event-pill.clustered{
  padding:.3rem .4rem;
  min-height:32px;
  font-size:.9rem;
}

/* Colores por categoría (pills) */
.event-pill.cat-Trabajo{ background:var(--cat-trabajo); color:#03121f }
.event-pill.cat-Tarea{ background:var(--cat-tarea); color:#051a13 }
.event-pill.cat-Citas{ background:var(--cat-citas); color:#1b1203 }
.event-pill.cat-Cumpleaños{ background:var(--cat-cumple); color:#03150a }
.event-pill.cat-Otros{ background:var(--cat-otros); color:#140a2b }
/* Festivo por si se pinta en vista de tiempo */
.event-pill.cat-Festivo{ background:#e11d48; color:#fff }

/* Mensaje vacío para vista Día */
.empty{
  color:var(--muted); background:transparent; border-top:1px dashed rgba(255,255,255,.15);
  padding:1rem; text-align:center;
}
html[data-theme="light"] .empty{ border-top-color: rgba(17,24,39,.15) }

/* =========================
   FAB global + Speed-dial (único)
   ========================= */
:root { --fab-rot: 135deg; }

.fab{
  position:fixed; right:18px; bottom:calc(18px + env(safe-area-inset-bottom)); z-index:60;
  width:56px; height:56px; border-radius:999px;
  background:var(--primary); color:#fff; border:0;
  display:inline-flex; align-items:center; justify-content:center; gap:.25rem;
  box-shadow:0 14px 32px rgba(14,165,233,.35);
  transition: transform .25s ease, background-color .2s ease, box-shadow .2s ease;
}
.fab:focus{ outline:none; box-shadow:0 0 0 3px var(--ring) }
.fab.spin{ transform: rotate(var(--fab-rot)); }
/* Mantener recto el icono calendario cuando el FAB gira */
.fab .icon{ transition: transform .25s ease, opacity .15s ease; }
.fab.spin .icon-cal{ transform: rotate(calc(-1 * var(--fab-rot))); }
/* FAB en light */
html[data-theme="light"] .fab{ background: var(--primary) !important; color:#fff; }

/* Menú del FAB */
.fab-menu{
  position: fixed;
  right: 18px;
  bottom: calc(84px + env(safe-area-inset-bottom)); /* 56 FAB + margen */
  display: flex;
  flex-direction: column;
  gap: .55rem;
  z-index: 59;
  pointer-events: none;
}
.fab-open .fab-menu{ pointer-events: auto; }

.fab-menu .fab-mini{
  display:inline-flex; align-items:center; gap:.5rem;
  width:auto; min-width:44px; height:44px; padding:0 .75rem;
  border-radius:999px; border:0; cursor:pointer; color:#fff;
  background:#0f172a; /* buen contraste en light y dark */
  box-shadow:0 10px 24px rgba(0,0,0,.25);
  opacity:0; transform: translateY(8px) scale(.85);
  transition: opacity .18s ease, transform .18s ease, background-color .2s ease;
}
.fab-open .fab-menu .fab-mini{ opacity:1; transform: translateY(0) scale(1); }
.fab-menu .fab-mini .icon{ width:18px; height:18px; color:#fff; stroke-width:2; }
.fab-menu .fab-mini span{
  display:inline-block; font-weight:700; font-size:.9rem;
  white-space:nowrap; max-width:180px; overflow:hidden; text-overflow:ellipsis;
}
@media (max-width: 520px){
  .fab-menu .fab-mini span{ display:none; }
}

/* =========================
   Bottom Sheet (Añadir/Editar)
   ========================= */
.sheet{
  position:fixed; left:0; right:0; bottom:0; z-index:90;
  background:var(--panel); border-top-left-radius:1rem; border-top-right-radius:1rem;
  border-top:1px solid rgba(255,255,255,.08);
  transform: translateY(110%); transition: transform .25s ease-out;
  max-height:85vh; overflow:auto; padding: .5rem 1rem calc(1rem + env(safe-area-inset-bottom)) 1rem;
}
html[data-theme="light"] .sheet{ border-top-color: rgba(17,24,39,.08) }
.sheet.open{ transform: translateY(0) }

.sheet-head{ display:flex; align-items:center; gap:.5rem; position:sticky; top:0; padding:.6rem 0; background:var(--panel) }
.sheet-head h3{ margin:.2rem 0 }
.event-form{ display:flex; flex-direction:column; gap:.7rem }
.event-form label{ display:flex; flex-direction:column; gap:.35rem; font-size:.95rem }
.event-form input[type="text"],
.event-form input[type="time"],
.event-form input[type="date"],
.event-form input[type="file"],
.event-form select{
  background:var(--card); border:1px solid rgba(255,255,255,.12);
  border-radius:.6rem; padding:.6rem .7rem; color:var(--text)
}
html[data-theme="light"] .event-form input,
html[data-theme="light"] .event-form select{
  border-color: rgba(17,24,39,.12);
}

/* Adjuntos en el sheet */
.attachments-preview{
  display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
  gap:.5rem; margin-top:.5rem
}
.attachment-card{
  background:#23262d;
  border:1px solid rgba(255,255,255,.08); border-radius:.6rem; padding:.4rem
}
html[data-theme="light"] .attachment-card{
  background:#eef2ff; border-color: rgba(17,24,39,.12)
}
.attachment-card .name{ font-size:.8rem; color:var(--muted) }
.attachment-card img, .attachment-card video{
  width:100%; border-radius:.4rem; max-height:140px; object-fit:cover
}

/* =========================
   Iconos SVG base (único)
   ========================= */
.icon{
  width:22px; height:22px; display:inline-block;
  fill:none; stroke: currentColor; stroke-width:2;
  stroke-linecap:round; stroke-linejoin:round;
}
.icon path[fill], .icon rect[fill]{ fill: currentColor; }

/* =========================
   Utilidades y responsive
   ========================= */
::selection{ background:rgba(14,165,233,.35) }
:focus-visible{ outline:2px solid var(--primary); outline-offset:2px }

@media (max-width: 900px){
  .time-header{ top:64px }
  .weekday-row > div{ font-size:.8rem }
  .day{ min-height:90px }
}

.app-logo{
  margin-left:.4rem;
  border-radius:8px;
  box-shadow:0 2px 8px rgba(0,0,0,.2);
}

/* ==== Transición suave al cambiar de tema ==== */
:where(html.theme-anim) :where(
  body, .topbar, .drawer, .drawer-backdrop, .calendar-panel,
  .time-panel, .day, .weekday-row > div, .time-header, .time-days-header, .day-col,
  .search-wrap input[type="search"], .search-results, .checks label, .segmented label,
  button, .fab, .sheet, .event-form input, .event-form select, .attachment-card,
  .event-pill, .event-tag, .app-logo
){
  transition:
    background-color .35s ease,
    color .35s ease,
    border-color .35s ease,
    box-shadow .35s ease,
    fill .35s ease,
    stroke .35s ease;
}
@media (prefers-reduced-motion: reduce){
  html.theme-anim * { transition: none !important; }
}

/* === Jump a fecha: pill + modo oscuro del date === */
.jump-row{ display:inline-flex; align-items:center; gap:0; }
.jump-row input[type="date"]{
  height:40px; padding:0 .9rem;
  border-radius:999px 0 0 999px;
  background:var(--card); color:var(--text);
  border:1px solid rgba(255,255,255,.12);
  border-right:0;                 /* une con el botón */
  color-scheme: dark;             /* UI del date en dark */
}
html[data-theme="light"] .jump-row input[type="date"]{
  border-color:rgba(17,24,39,.12);
  color-scheme: light;            /* y en light */
}
/* icono del selector de fecha visible en dark (WebKit/Chromium) */
.jump-row input[type="date"]::-webkit-calendar-picker-indicator{
  filter: invert(1) opacity(.8);
}
html[data-theme="light"] .jump-row input[type="date"]::-webkit-calendar-picker-indicator{
  filter:none;
}
#jumpBtn{
  height:40px;
  border-radius:0 999px 999px 0;
  margin-left:-1px;               /* elimina la “doble” línea entre ambos */
}

/* === Placeholder de la búsqueda: más bonito === */
.search-wrap input::placeholder{
  color:var(--muted);
  opacity:.85;
  font-style:italic;
  letter-spacing:.1px;
}

/* === Hamburguesa: centrada y líneas iguales === */
.hamburger{
  width:40px; height:40px; padding:8px;
  display:flex; flex-direction:column; justify-content:center; align-items:center; gap:5px;
  border-radius:.6rem; background:transparent; border:1px solid rgba(255,255,255,.12);
}
html[data-theme="light"] .hamburger{ border-color:rgba(17,24,39,.12) }
.hamburger span{
  width:20px; height:2px; background:var(--text);
  border-radius:2px; transform-origin:center;
  will-change:transform; backface-visibility:hidden;
}
/* animación activa (mismas transformaciones, líneas uniformes) */
.hamburger.active span:nth-child(1){ transform: translateY(7px) rotate(45deg) }
.hamburger.active span:nth-child(2){ opacity:0 }
.hamburger.active span:nth-child(3){ transform: translateY(-7px) rotate(-45deg) }

/* Ajustes del control "Ir a fecha" para que no tape botones */
.jump-row {
  gap: .5rem;
  flex-wrap: wrap;
}

.jump-row input[type="date"]{
  max-width: 160px;      /* más compacto */
  height: 36px;          /* alinea con botones */
  padding: .3rem .6rem;
  border-radius: .6rem;  /* más redondeado */
}

.jump-row #jumpBtn{
  height: 36px;
}

/* Un pelín de separación extra de los grupos laterales */
.calendar-nav .nav-left,
.calendar-nav .nav-right{
  gap: .6rem;
}

/* === FAB: animación dinámica en hover === */
.fab{
  isolation: isolate;        /* crea stacking context para los halos */
  z-index: 60;               /* ya lo tienes, reafirmamos */
  overflow: visible;         /* deja que los halos salgan del botón */
}

/* Float + glow en hover (solo si no está girando) */
.fab:not(.spin):hover{
  transform: translateY(-2px) scale(1.06);
  box-shadow: 0 20px 46px rgba(14,165,233,.42);
}

/* Halo giratorio (detrás del botón) */
.fab::before{
  content:"";
  position:absolute;
  inset:-10px;                      /* un poco más grande que el botón */
  border-radius:999px;
  background:
    conic-gradient(from 0deg,
      transparent 0 320deg,
      rgba(14,165,233,.85) 360deg); /* usa --primary */
  filter: blur(10px);
  opacity:0;
  z-index:-1;
  transform: rotate(0deg);
  transition: opacity .18s ease;
  pointer-events:none;
}
.fab:hover::before{ opacity:.9; animation: fab-sweep 2.2s linear infinite; }

/* Onda/ripple repetida mientras haya hover */
.fab::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  border:2px solid rgba(14,165,233,.55);
  transform: scale(.9);
  opacity:0;
  pointer-events:none;
}
.fab:hover::after{ animation: fab-ripple 1.4s ease-out infinite; opacity:.9; }

/* Si está en modo spin (al abrir), no apliques el float de hover */
.fab.spin:hover{ transform: rotate(var(--fab-rot)); }

/* Un pelín de feedback en el icono */
.fab:not(.spin):hover .icon{ transform: scale(1.06); }

/* Accesible: muestra halo también con teclado */
.fab:focus-visible::before{ opacity:.95; animation: fab-sweep 2.2s linear infinite; }

/* Animaciones */
@keyframes fab-sweep{
  to{ transform: rotate(1turn); }
}
@keyframes fab-ripple{
  0%  { transform: scale(.9);  opacity:.9; }
  70% { transform: scale(1.25); opacity:.2; }
  100%{ transform: scale(1.35); opacity:0; }
}

/* Respeto a usuarios con reducción de movimiento */
@media (prefers-reduced-motion: reduce){
  .fab:not(.spin):hover{ transform:none; }
  .fab::before, .fab::after{ animation:none !important; opacity:0 !important; }
}

/* En pantallas táctiles, desactiva efectos de hover (no aportan) */
@media (pointer: coarse){
  .fab::before, .fab::after{ display:none; }
}

/* === FAB: giro en hover (no afecta al estado .spin) === */
.fab{ will-change: transform; }

/* Giro de 360º + pequeño “float” */
.fab:not(.spin):hover{
  transform: translateY(-2px) scale(1.06) rotate(360deg);
  transition: transform .55s cubic-bezier(.22,.75,.2,1),
              box-shadow .2s ease, background-color .2s ease;
}

/* --- FAB: solo gira el icono en hover --- */

/* El botón puede “flotar” y escalar en hover, PERO sin rotar */
.fab:not(.spin):hover{
  transform: translateY(-2px) scale(1.06); /* <- sin rotate */
  transition: transform .25s ease, box-shadow .2s ease, background-color .2s ease;
}

/* Prepara los iconos para animación suave */
.fab .icon{
  transform-origin: 50% 50%;
  transition: transform .55s cubic-bezier(.22,.75,.2,1);
}

/* Gira SOLO el + cuando el botón NO está abierto */
.fab:not(.spin):hover .icon-plus{
  transform: rotate(360deg);
}

/* Si prefieres que también gire el icono de calendario cuando esté cerrado,
   añade esta línea (opcional): */
/* .fab:not(.spin):hover .icon-cal{ transform: rotate(360deg); } */

/* Cuando el FAB está abierto (.spin), no hagas rotaciones extra en hover */
.fab.spin:hover .icon{
  transform: none !important;
}

/* ==== FAB: solo gira el "+" y el calendario SIEMPRE recto ==== */

/* Animación suave solo en los SVG */
.fab .icon{
  transform-origin: 50% 50%;
  transition: transform .55s cubic-bezier(.22,.75,.2,1);
}

/* 1) FAB cerrado: gira SOLO el "+" en hover */
.fab:not(.spin):hover .icon-plus{
  transform: rotate(360deg);
}
/* y el calendario, recto */
.fab:not(.spin):hover .icon-cal{
  transform: none !important;
}

/* 2) FAB abierto: el botón gira, pero el calendario compensa para quedar recto */
:root{ --fab-rot: 135deg; }
.fab.spin{ transform: rotate(var(--fab-rot)); }

/* Compensación constante del calendario en abierto */
.fab.spin .icon-cal{
  transform: rotate(calc(-1 * var(--fab-rot))) !important;
}
/* Incluso si pasas el cursor estando abierto, sigue recto */
.fab.spin:hover .icon-cal{
  transform: rotate(calc(-1 * var(--fab-rot))) !important;
}

.calendar-grid{ will-change: transform,opacity }
.month-out-left{ animation: monthOutLeft .22s ease both }
.month-in-right{ animation: monthInRight .22s ease both }
.month-out-right{ animation: monthOutRight .22s ease both }
.month-in-left{ animation: monthInLeft .22s ease both }

@keyframes monthOutLeft{ to{ transform:translateX(-12px); opacity:0 } }
@keyframes monthInRight{ from{ transform:translateX(12px); opacity:0 } to{ transform:none; opacity:1 } }
@keyframes monthOutRight{ to{ transform:translateX(12px); opacity:0 } }
@keyframes monthInLeft{ from{ transform:translateX(-12px); opacity:0 } to{ transform:none; opacity:1 } }

.now-line{ position:absolute; left:0; right:0; height:2px; background:#ef4444; box-shadow:0 0 0 2px rgba(239,68,68,.15) }
.now-dot{ position:absolute; width:10px; height:10px; border-radius:999px; background:#ef4444; left:2px; top:-4px; animation: ping 1.6s ease-out infinite }
@keyframes ping{ 0%{ box-shadow:0 0 0 0 rgba(239,68,68,.6) } 100%{ box-shadow:0 0 0 14px rgba(239,68,68,0) } }

.search-results mark{ background: color-mix(in srgb, var(--primary) 22%, transparent); color: inherit; padding:0 .08em; border-radius:.2em }

.btn-ripple{ position:relative; overflow:hidden }
.btn-ripple::after{
  content:""; position:absolute; border-radius:50%; inset:auto; width:8px; height:8px;
  background:rgba(255,255,255,.35); transform:translate(-50%,-50%) scale(0); opacity:0;
  animation: none;
}
.btn-ripple.is-animating::after{ animation:ripple .6s ease-out }
@keyframes ripple{ 0%{ transform:translate(var(--x),var(--y)) scale(0); opacity:.55 }
100%{ transform:translate(var(--x),var(--y)) scale(18); opacity:0 } }

.sheet.open{ animation: sheetPop .28s cubic-bezier(.18,.9,.22,1.12) both }
@keyframes sheetPop{ 0%{ transform:translateY(110%) } 70%{ transform:translateY(-6px) } 100%{ transform:translateY(0) } }
@media (prefers-reduced-motion: reduce){ .sheet.open{ animation:none } }

.event-tag{ transition: transform .12s ease, box-shadow .12s ease }
.event-tag:hover{ transform: translateY(-1px); box-shadow:0 3px 10px rgba(0,0,0,.18) }
.day{ transition: box-shadow .15s ease, transform .12s ease }
.day:active{ transform: translateY(1px); box-shadow: inset 0 0 0 9999px rgba(255,255,255,.02) }

body::before{
  content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/><feColorMatrix type='saturate' values='0'/><feComponentTransfer><feFuncA type='table' tableValues='0 0 .035 0'/></feComponentTransfer></filter><rect width='100%' height='100%' filter='url(%23n)'/></svg>");
  opacity:.6; mix-blend-mode: soft-light;
}

@media (hover:hover){
  .event-pill{ transform: translateZ(0); transition: transform .12s ease }
  .event-pill:hover{ transform: translateY(-1px) scale(1.01) }
}

/* ===== Mobile: nav con 2 filas (Mes arriba, Año abajo) ===== */
@media (max-width: 600px) {
  .calendar-nav{
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    grid-template-areas:
      "monthPrev  navCenter  monthNext"
      "yearPrev   navCenter  yearNext";
    gap: .5rem 1rem;
    align-items: center;
  }
  .calendar-nav .nav-left,
  .calendar-nav .nav-right{
    /* Permitimos posicionar los botones individualmente */
    display: contents;
  }
  /* Colocamos cada botón en su área */
  #prevMonth{ grid-area: monthPrev; }
  #nextMonth{ grid-area: monthNext; }
  #prevYear { grid-area: yearPrev; }
  #nextYear { grid-area: yearNext; }
  .calendar-nav .nav-center{ grid-area: navCenter; text-align: center; }

  /* Botones algo más compactos en móvil */
  .calendar-nav button{ padding: .55rem .8rem; }
}

/* ===== Mobile: los eventos del mes como líneas finas de color ===== */
@media (max-width: 600px) {
  /* El día se convierte en contenedor relativo para “pegar” las líneas abajo */
  .calendar-grid .day{
    position: relative;
    padding-bottom: 18px;       /* deja sitio a las líneas */
    overflow: hidden;
  }
  /* Contenedor de líneas pegado abajo */
  .calendar-grid .day .events-tags{
    position: absolute;
    left: 6px; right: 6px; bottom: 6px;
    display: flex;
    flex-direction: column;     /* apiladas */
    gap: 2px;
    max-height: 14px;           /* muestra 3–4 líneas como máx. */
    overflow: hidden;
  }
  /* Cada evento es una barrita; ocultamos el texto */
  .calendar-grid .day .events-tags .event-tag{
    display: block;
    height: 4px;
    padding: 0;
    border-radius: 3px;
    font-size: 0;               /* texto invisible pero accesible con title */
    line-height: 0;
    box-shadow: none;
    opacity: .95;
  }
  /* Si tus colores de categoría se aplican por .cat-*, se mantendrán aquí. */
}

@media (max-width: 600px) {
  .calendar-grid{
    gap: .5rem;
  }
  .calendar-grid .day{
    border-radius: 12px;
    min-height: 70px;           /* ajusta a tu gusto */
  }
  .calendar-grid .day .day-head .num{
    font-size: .95rem;
  }
}

/* ===== Confirm Modal ===== */
dialog.confirm-modal {
  border: 1px solid var(--border);
  border-radius: .9rem;
  padding: 0;
  background: var(--panel);
  color: var(--text);
  width: min(520px, 92vw);
  box-shadow: 0 10px 30px rgba(0,0,0,.25), 0 0 0 1px var(--border);
}
dialog.confirm-modal::backdrop {
  background: rgba(0,0,0,.4);
}

.confirm-wrap { padding: 1rem 1rem .75rem; }
.confirm-head { display:flex; gap:.75rem; align-items:flex-start; }
.confirm-icon { font-size:1.4rem; line-height:1; }
.confirm-title { margin:.1rem 0 .25rem; font-size:1.05rem; font-weight:700; }
.confirm-text { margin:0; color: var(--muted); line-height:1.5; }

.confirm-actions {
  display:flex; gap:.5rem; justify-content:flex-end;
  padding: .75rem 1rem 1rem;
}
.confirm-actions .btn {
  appearance:none; border:1px solid var(--border); background:transparent;
  color: var(--text); border-radius:.6rem; font-weight:600; padding:.55rem .9rem;
  cursor:pointer;
}
.confirm-actions .btn:hover { background: rgba(255,255,255,.05); }
.confirm-actions .btn.primary { background: var(--primary); color:#fff; border-color: transparent; }
.confirm-actions .btn.danger  { background: #ef4444; color:#fff; border-color: transparent; }

.pill.all-day { min-height: 28px; }

/* === Update Gate (overlay) === */
.update-gate{
  position: fixed;
  inset: 0;
  z-index: 10050;          /* por encima de topbar, drawer, sheet y toasts */
  display: grid;
  place-items: center;
  pointer-events: auto;
}
.update-gate.hidden,
.update-gate[aria-hidden="true"]{ display: none; }

.update-gate .ug-backdrop{
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(3px);
  z-index: 0;
}

.update-gate .ug-card{
  position: relative;
  z-index: 1;
  width: min(520px, 92vw);
  background: var(--panel);
  color: var(--text);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 1rem;
  padding: 1rem;
  box-shadow: 0 10px 30px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.06);
}
html[data-theme="light"] .update-gate .ug-card{
  border-color: rgba(17,24,39,.1);
  box-shadow: 0 10px 30px rgba(0,0,0,.15), 0 0 0 1px rgba(17,24,39,.06);
}

/* botón con spinner opcional */
.ug-btn .spinner{ display:none; width:16px; height:16px; border:2px solid rgba(255,255,255,.4);
  border-top-color:#fff; border-radius:50%; margin-right:.5rem; vertical-align:-3px; }
.ug-btn.loading .spinner{ display:inline-block; animation: ugspin .8s linear infinite; }
@keyframes ugspin{ to { transform: rotate(1turn); } }

/* evita hacer scroll detrás del overlay */
body.update-block{ overflow: hidden; }

/* asegúrate de tener esto */
.hidden { display: none !important; }

/* overlay del gate SIEMPRE encima */
#updateGate {
  position: fixed;
  inset: 0;
  z-index: 100000;       /* más alto que todo */
  display: flex;         /* centra tu contenido interno */
  align-items: center;
  justify-content: center;
}

/* cuando esté “oculto” */
#updateGate.hidden { display: none !important; }

/* opcional: bloquear scroll cuando hay gate */
body.update-block { overflow: hidden; }

/* ===== Formato tipo lista (como la captura) ===== */
.list-form .title-input{
  width:100%; padding:.7rem .8rem; border-radius:.6rem;
  border:1px solid rgba(255,255,255,.12);
  background:var(--card); color:var(--text); font-size:1rem; margin-bottom:.4rem;
}
html[data-theme="light"] .list-form .title-input{ border-color: rgba(17,24,39,.12); }

.list-form .row{
  display:flex; align-items:center; gap:.65rem;
  padding:.8rem 0; border-bottom:1px solid rgba(255,255,255,.08);
}
html[data-theme="light"] .list-form .row{ border-bottom-color: rgba(17,24,39,.08); }
.list-form .row:last-of-type{ border-bottom:0; }
.list-form .row .icon{ width:20px; height:20px; opacity:.9 }
.list-form .row .row-label{ font-weight:700; flex:1 }
.list-form .row .row-value{
  margin-left:auto; background:transparent; border:0; color:var(--text);
}
.list-form .row input[type="text"],
.list-form .row input[type="date"],
.list-form .row input[type="time"],
.list-form .row select,
.list-form .row textarea{
  background:transparent; border:0; color:var(--text); width:100%;
  padding:.2rem 0; outline:none;
}
.list-form .row textarea{ min-height:72px; resize:vertical; }

.list-form .row-daterange{
  gap:.75rem; align-items:flex-start;
}
.list-form .row-daterange .dt{ flex:1; }
.list-form .row-daterange .dt-line{
  display:flex; gap:.4rem; align-items:center;
}
.list-form .row-daterange input[type="date"],
.list-form .row-daterange input[type="time"]{
  background:var(--card); border:1px solid rgba(255,255,255,.12);
  border-radius:.5rem; padding:.45rem .55rem; width:auto;
}
html[data-theme="light"] .list-form .row-daterange input{ border-color: rgba(17,24,39,.12); }
.list-form .row-daterange .arrow{ padding:.55rem .35rem; color:var(--muted); }

/* cuando es "todo el día": oculta los time inputs */
.list-form .row-daterange.all-day input[type="time"]{ display:none; }

/* Switch accesible */
.switch{
  margin-left:auto; appearance:none; width:46px; height:26px; background:#3b3f4a;
  border-radius:999px; position:relative; border:1px solid rgba(255,255,255,.18);
  cursor:pointer; outline:none; transition:background .2s ease;
}
.switch::after{
  content:""; position:absolute; top:2px; left:2px; width:22px; height:22px;
  border-radius:50%; background:#fff; transition: transform .2s ease;
}
.switch:checked{ background:var(--primary); border-color:transparent; }
.switch:checked::after{ transform: translateX(20px); }

/* En el row de adjuntos, el botón parece link */
.file-row .row-link{
  margin-left:.25rem; background:transparent; border:0; color:var(--text);
  text-align:left; padding:.25rem 0; font-weight:600; cursor:pointer;
}
.file-row .row-link:hover{ text-decoration:underline; }

/* === Selects legibles en light/dark === */
:root{
  --select-bg: #fff;
  --select-fg: #111;
  --select-muted: #6b7280; /* gris opciones deshabilitadas en light */
}

[data-theme="dark"]{
  --select-bg: #0b1224;    /* mismo tono que tus paneles oscuros */
  --select-fg: #e6ecff;
  --select-muted: rgba(230,236,255,.55);
}

/* El propio select (lista cerrada) */
select,
select:focus{
  background-color: var(--select-bg);
  color: var(--select-fg);
  border: 1px solid var(--border, rgba(255,255,255,.12));
}

/* Opciones del desplegable (lista abierta) – funciona en Chrome/Android, Firefox, Edge */
select option{
  background-color: var(--select-bg);
  color: var(--select-fg);
}
select option:disabled{
  color: var(--select-muted);
}

/* Por si los tienes con ids específicos */
#eventAlert, #eventRepeat{
  background-color: var(--select-bg);
  color: var(--select-fg);
}
#eventAlert option, #eventRepeat option{
  background-color: var(--select-bg);
  color: var(--select-fg);
}

/* Asegura que el pie quede abajo del drawer */
#drawer{
  display:flex;
  flex-direction:column;
}

/* Pie de versión */
.drawer-footer{
  margin-top:auto;
  padding:.75rem 1rem;
  font-size:.85rem;
  border-top:1px solid var(--border, rgba(255,255,255,.12));
  color:var(--muted, #a1a8c3);
  background:var(--panel, transparent);
}
[data-theme="light"] .drawer-footer{
  border-top-color: rgba(0,0,0,.08);
  color:#475569;
}
.drawer-footer .muted{ opacity:.85; margin-right:.4rem; }

/* ===================== Add Event — diseño móvil ===================== */
@media (max-width: 600px){
  /* Que el sheet llene el ancho y quede pegado abajo en móvil */
  #addEventSheet{
    width: 100vw;
    max-width: none;
    margin: 0;
    border-radius: 16px 16px 0 0;
  }
  /* Si tu sheet tiene contenedores internos, cubrimos variantes comunes */
  #addEventSheet .sheet, 
  #addEventSheet .sheet-card,
  #addEventSheet .panel {
    width: 100vw;
    max-width: none;
    margin: 0;
    border-radius: 16px 16px 0 0;
  }

  /* Tipografía cómoda en inputs para evitar el “auto-zoom” de iOS */
  #addEventSheet input,
  #addEventSheet select,
  #addEventSheet textarea,
  #addEventSheet button{
    font-size: 16px;          /* <= clave en iOS */
    line-height: 1.2;
  }

  /* Altura mínima de controles y chips fecha/hora */
  #addEventSheet input[type="date"],
  #addEventSheet input[type="time"],
  #addEventSheet select{
    min-height: 46px;
  }

  /* Reducir huecos verticales */
  #addEventSheet .row,
  #addEventSheet .field{
    margin-bottom: 10px;
  }
  #addEventSheet label{
    font-size: .95rem;
    margin-bottom: .35rem;
  }

  /* Contenedor de fecha/hora de inicio/fin en grid compacto */
  #rowDateTime{
    display: grid;
    grid-template-columns: 1fr min-content 1fr; /* inicio | → | fin */
    gap: 10px;
    align-items: center;
  }
  /* Cuando está activado "Todo el día", solo una columna */
  #rowDateTime.all-day{
    grid-template-columns: 1fr;
  }
  /* En pantallas muy estrechas, apilar y ocultar la flecha */
  @media (max-width: 360px){
    #rowDateTime{
      grid-template-columns: 1fr;
    }
    #rowDateTime .arrow{
      display: none;
    }
  }

  /* Padding más contenido + área segura iOS */
  #addEventSheet .sheet-body,
  #addEventSheet .content{
    padding: 14px 16px calc(16px + env(safe-area-inset-bottom));
  }

  /* Botonera inferior más junta y con área segura */
  #addEventSheet .actions{
    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
    gap: 10px;
  }
}

#duplicateEventBtn { margin-right: .25rem; }

/* Swipe fiable en Android */
#monthView, #calendarGrid,
#timeView,  #timeGrid, #timeDaysHeader {
  touch-action: pan-y;            /* el navegador solo gestiona scroll vertical */
  overscroll-behavior-x: contain; /* evita gestos laterales del navegador */
}

/* Notas: sin scroll y altura libre */
#eventNotes{
  height: auto;         /* deja que JS la ajuste */
  max-height: none;     /* sin límite */
  overflow-y: hidden;   /* oculta el scroll interno */
  resize: none;         /* opcional: usuario no “estira” manualmente */
  line-height: 1.35;    /* queda más legible */
}

/* Por si el contenedor tuviese límites */
#notesWrap, .notes-wrap, .notesRow {
  max-height: none !important;
  overflow: visible !important;
}

/* Azul para la categoría Trabajo */
.event-tag.cat-Trabajo,
.pill.cat-Trabajo,
.ag-item.cat-Trabajo,
.sf-item.cat-Trabajo {
  background: #3b82f6 !important; /* azul */
  color: #fff !important;          /* texto en blanco para buen contraste */
}

body.tags-v2 .events-tags .event-tag::first-letter {
  all: unset !important;
}

body.tags-v2 .events-tags .event-tag .t { display: none !important; }
